- content_for :title, 'Connected news feeds'
- total_feeds = @total_feeds
- total_articles = number_with_delimiter(@total_articles)
- recently_synced = @recently_synced_count
- stale_feeds = @stale_feed_count

.page-shell.pb-5
  .container
    = render 'shared/breadcrumbs', items: [{ label: 'News coverage' }]

    %section.page-hero.mb-5
      .row.align-items-center.gy-4
        .col-lg-7
          %p.hero-kicker Curated intelligence
          %h1.display-5.fw-bold.mb-3 Track every feed powering Stat Machine coverage
          %p.lead.text-white-50.mb-4
            Stay on top of which sources are fueling sentiment analysis and event coverage.
            Each feed is polled continuously with freshness tracking, so you know which leagues have the richest storytelling.
          .d-flex.flex-wrap.gap-3
            .stat-chip
              %span.text-uppercase.small.text-white-50 Connected Feeds
              %strong= total_feeds
              %small.text-white-50 active RSS / Atom endpoints
            .stat-chip
              %span.text-uppercase.small.text-white-50 Indexed Articles
              %strong= total_articles
              %small.text-white-50 enriched for tags and sentiment
            .stat-chip
              %span.text-uppercase.small.text-white-50 Fresh in 24h
              %strong= recently_synced
              %small.text-white-50 feeds checked or imported today
        .col-lg-5
          .glass-panel
            %p.eyebrow.text-white-50.mb-2 Feed health
            %h3.h5.text-white.mb-3 Coverage freshness monitor
            %p.text-white-50.mb-4
              %strong= stale_feeds
              stale sources haven't delivered anything in the past day. Consider reviewing them or syncing manually.
            .d-flex.flex-wrap.gap-2
              = link_to 'View stale feeds', feed_sources_path(anchor: 'stale'), class: 'btn btn-outline-light btn-sm'
              = link_to 'Sync via CLI', '#', class: 'btn btn-light btn-sm disabled', aria: { disabled: true }

    %section.page-section.pt-0{ id: 'stale' }
      - if @feed_sources.present?
        .row.g-4
          - @feed_sources.each do |feed_source|
            - last_imported = feed_source.last_imported_at
            - last_checked = feed_source.last_checked_at
            - activity_time = feed_source.last_activity_at
            - status_label = feed_source.recently_synced?(window: 24.hours) ? 'Fresh' : 'Stale'
            - status_class = feed_source.recently_synced?(window: 24.hours) ? 'bg-success bg-opacity-10 text-success border border-success border-opacity-25' : 'bg-warning bg-opacity-10 text-warning border border-warning border-opacity-25'
            .col-12.col-md-6
              = link_to feed_source_path(feed_source), class: 'surface-card link-card h-100 text-decoration-none' do
                %div.d-flex.justify-content-between.align-items-start.mb-2
                  %div
                    %span.eyebrow.text-primary.mb-1 Source
                    %h3.h5.fw-bold.mb-1= feed_source.name
                    %p.text-muted.small.mb-0= feed_source.feed_url
                  %span.badge{ class: status_class }= status_label
                %p.text-muted.small.mb-3
                  Latest ingestion #{activity_time ? "happened #{time_ago_in_words(activity_time)} ago" : 'has not run yet'}.
                .d-flex.flex-wrap.gap-2.align-items-center
                  %span.badge.bg-light.text-muted.border
                    = pluralize(feed_source.articles_count, 'article')
                  - if last_imported
                    %span.badge.bg-indigo.text-white
                      Imported #{time_ago_in_words(last_imported)} ago
                  - elsif last_checked
                    %span.badge.bg-secondary.bg-opacity-10.text-secondary.border
                      Checked #{time_ago_in_words(last_checked)} ago
      - else
        .empty-state
          %p.text-muted.mb-3 No feeds have been connected yet.
          = link_to 'Seed feed sources', '#', class: 'btn btn-primary disabled', aria: { disabled: true }
