- content_for :title, "#{@competition.name} events"

- events_count = @events.size
- live_events = @events.count { |event| event.primary_market&.inplay? }
- breadcrumb_items = [{ label: 'Countries', path: countries_path }]
- if @country
  - breadcrumb_items << { label: @country.name, path: country_competitions_path(@country) }
- breadcrumb_items << { label: @competition.name }

.page-shell.pb-5
  .container
    = render 'shared/breadcrumbs', items: breadcrumb_items

    %section.page-hero.mb-5
      .row.align-items-center.gy-4
        .col-lg-7
          %p.hero-kicker Competition Pulse
          %h1.display-5.fw-bold.mb-3= @competition.name
          %p.lead.text-white-50.mb-4
            All live and upcoming fixtures flowing from Betfair are monitored for pricing gaps, so you can strike before markets settle.
          .d-flex.flex-wrap.gap-3
            .stat-chip
              %span.text-uppercase.small.text-white-50 Events tracked
              %strong= events_count
              %small.text-white-50 with verified markets
            .stat-chip
              %span.text-uppercase.small.text-white-50 Live edges
              %strong= live_events
              %small.text-white-50 markets currently in-play
            .stat-chip
              %span.text-uppercase.small.text-white-50 Competition ID
              %strong= @competition.betfair_id
              %small.text-white-50= @country&.country_code || 'Global'
        .col-lg-5
          .glass-panel
            %span.eyebrow.text-white-50 League snapshot
            %h3.h5.text-white.fw-semibold.mb-3
              = @country&.name || 'Global coverage'
              %small.text-white-50.ms-2= @country&.region
            %p.text-white-50.mb-3
              Market sync ensures every fixture inherits liquidity markers, exchange data, and AI predictions when available.
            .d-flex.flex-wrap.gap-2
              %span.badge.bg-light.text-dark= "#{events_count} active events"
              %span.badge.bg-dark.text-white= @competition.betfair_id

    %section.page-section.pt-0
      - if @events.present?
        .row.g-4
          - @events.each do |event|
            - market = event.primary_market
            - kickoff = event.kick_off&.in_time_zone || event.kick_off
            .col-12
              = link_to country_competition_event_path(@country, @competition, event), class: "surface-card link-card event-card text-decoration-none text-dark" do
                %div.d-flex.align-items-center.justify-content-between.gap-3.flex-wrap
                  %div.flex-grow-1
                    %div.d-flex.align-items-center.gap-2.mb-1
                      %strong.h5.mb-0= event.name
                      - if market&.inplay?
                        %span.badge.bg-danger.bg-opacity-75.text-white.small LIVE
                    %p.text-muted.small.mb-0
                      - if kickoff
                        = kickoff.strftime('%a %d %b Â· %H:%M')
                      - else
                        Upcoming time TBD
                      - if market&.status.present?
                        = " Â· #{market.status.titleize}"
                  %div.text-end
                    - if market&.name.present?
                      %span.badge.bg-light.text-dark= market.name
                    - if market&.last_synced_label.present?
                      %p.text-muted.small.mb-0= "Updated #{time_ago_in_words(market.last_synced_label)} ago"
                = render 'events/market_probabilities',
                  market: market,
                  progress_class: 'mt-2',
                  empty_message: 'No probabilities published yet.'
      - else
        .empty-state
          %p.text-muted.mb-3 No events have been recorded for this competition yet.
          = link_to "Sync events", country_competition_events_path(@country, @competition), class: "btn btn-primary"
