.container.py-4
  %nav{ "aria-label" => "breadcrumb" }
    %ol.breadcrumb.mb-4
      %li.breadcrumb-item= link_to "Countries", countries_path, class: "text-decoration-none"
      - if @country
        %li.breadcrumb-item= link_to @country.name, country_competitions_path(@country), class: "text-decoration-none"
      %li.breadcrumb-item.active= @competition.name

  .d-flex.justify-content-between.align-items-center.mb-3
    %div
      %h2.h4.mb-1= @competition.name
      %p.text-muted.mb-0= "#{@events.size} events tracked"
    %div.text-end
      %span.badge.bg-secondary= @competition.betfair_id
      - if @country
        %span.badge.bg-light.text-dark.ms-2= @country.country_code

  - if @events.present?
    .list-group.shadow-sm
      - @events.each do |event|
        - market = event.primary_market
        - percentages = market&.latest_probabilities || []
        - kickoff = event.kick_off&.in_time_zone || event.kick_off
        = link_to country_competition_event_path(@country, @competition, event), class: "list-group-item list-group-item-action py-3" do
          .d-flex.align-items-center.justify-content-between.flex-wrap.gap-3
            .flex-grow-1
              %div.d-flex.align-items-center.gap-2.mb-1
                %strong.text-dark= event.name
                - if market&.inplay?
                  %span.badge.bg-danger.p-1{ style: "font-size: 0.65rem;" } LIVE
              .small.text-muted
                - if kickoff
                  = kickoff.strftime("%a %d %b %H:%M")
                - else
                  = "TBD"
                - if market&.status.present?
                  = " Â· #{market.status}"
            .flex-grow-1
              - if percentages.present?
                .progress{ style: "height: 18px; border-radius: 4px; background-color: #f1f3f5;" }
                  - percentages.each_with_index do |data, idx|
                    - bg_class = ['bg-primary', 'bg-secondary', 'bg-success'][idx]
                    .progress-bar.border-end.border-white.border-1{ class: bg_class,
                      role: "progressbar",
                      style: "width: #{data[:percentage]}%",
                      title: "#{data[:name]}: #{data[:percentage]}%" }
                      - if data[:percentage].to_f > 15
                        %small.fw-bold{ style: "font-size: 0.65rem;" }= "#{data[:percentage]}%"
              - else
                %span.text-muted.small No prices yet
  - else
    .alert.alert-warning No events have been recorded for this competition yet.
